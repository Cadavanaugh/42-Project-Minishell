#include "../../minishell.h"

void builtin_cd(char **args, t_ms *shell)
{
    char    cwd[1024];
    char    *oldpwd;
    char    *dest;
    oldpwd = getcwd(cwd, sizeof(cwd));
    if (!args[1])
        dest = get_env_val("HOME", shell);
    else if (ft_strncmp(args[1], "-", 1) == 0 && !args[1][1])
        dest = get_env_val("OLDPWD", shell);
    else
		dest = args[1];
	if (!dest)
	{
		shell->last_status = 1;
		ft_putstr_fd("minishell: cd: HOME not set\n", 2);
		return ;
	}
    if (chdir(dest) != 0)
    {
        shell->last_status = 1;
        perror("minishell: cd");
        return ;
    }
    update_env_val("OLDPWD", oldpwd, shell);
    update_env_val("PWD", getcwd(cwd, sizeof(cwd)), shell);
    shell->last_status = 0;
}
